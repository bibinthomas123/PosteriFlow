 python experiments/test_priority_net.py --model models/prioritynet/priority_net_best.pth --data_dir data/test/
2025-11-25 09:10:55,970 - INFO - ‚úÖ Loaded config from /home/bibin/PosteriFlow/configs/enhanced_training.yaml
2025-11-25 09:10:55,970 - INFO -    use_transformer_encoder=False, overlap_importance_hidden=32
üîß Using provided configuration for PriorityNet.
2025-11-25 09:10:56,019 - INFO -    ‚ÑπÔ∏è  Strain encoder: TemporalStrainEncoder (CNN+BiLSTM)
Overlap use attention: True
2025-11-25 09:10:56,019 - INFO -    ‚úÖ Overlap analyzer: attention enabled (hidden_dim=32)
2025-11-25 09:10:56,031 - INFO - üîç PriorityNet Configuration:
2025-11-25 09:10:56,031 - INFO -    use_strain: True ‚Üí temporal_dim: 64
2025-11-25 09:10:56,031 - INFO -    use_edge_conditioning: True ‚Üí edge_dim: 32
2025-11-25 09:10:56,031 - INFO -    n_edge_types: 19
2025-11-25 09:10:56,032 - INFO -    hidden_dims: [640, 512, 384, 256]
2025-11-25 09:10:56,032 - INFO -    dropout: 0.25
2025-11-25 09:10:56,032 - INFO - ‚úÖ MultiModalFusion: attention enabled (4 heads, dropout=0.08)
2025-11-25 09:10:56,033 - INFO -    ‚úÖ Modal fusion: attention enabled (4 heads, dropout=0.08)
2025-11-25 09:10:56,033 - INFO - üîç PriorityNet Configuration: use_strain=True, use_edge_conditioning=True, n_edge_types=19
2025-11-25 09:10:56,033 - INFO -    dropout=0.25, hidden_dims=[640, 512, 384, 256]
2025-11-25 09:10:56,033 - INFO - ‚úÖ Enhanced PriorityNet initialized with attention fusion
2025-11-25 09:10:56,151 - INFO - ‚úÖ Loaded state_dict strict=True (perfect match)
2025-11-25 09:10:56,152 - INFO -
================================================================================
1Ô∏è‚É£  SYNTHETIC TESTS
================================================================================
2025-11-25 09:10:56,166 - INFO - ‚úÖ Perfect (‚ÜìSNR): œÅ=1.000
2025-11-25 09:10:56,174 - INFO - ‚úÖ Reverse (‚ÜëSNR): œÅ=1.000
2025-11-25 09:10:56,182 - INFO - ‚úÖ Random: œÅ=1.000
2025-11-25 09:10:56,191 - INFO - ‚úÖ Close SNR: œÅ=1.000
2025-11-25 09:10:56,209 - INFO - ‚úÖ Heavy overlap (5): œÅ=1.000
2025-11-25 09:10:56,209 - INFO - üìä Synthetic: 5/5 (100.0%)
2025-11-25 09:10:56,211 - INFO -  validation: 10 chunks, 100 samples per chunk
2025-11-25 09:10:56,212 - INFO - Loading validation chunks (streaming)...
2025-11-25 09:10:56,967 - INFO - Reached max samples limit: 500
Total processed: 500
Singles seen: 259
Artificial overlaps created: 129

Conversion complete:
  Success: 619
  Failed: 9
  Success rate: 98.6%
2025-11-25 09:10:56,967 - INFO - üìä Processing 619 scenarios for validation dataset...
2025-11-25 09:10:56,980 - INFO -
üìà VALIDATION PriorityNet dataset created: 619 scenarios
2025-11-25 09:10:56,980 - INFO -    BBH: 777 (42.6%)
2025-11-25 09:10:56,980 - INFO -    BNS: 651 (35.7%)
2025-11-25 09:10:56,980 - INFO -    NSBH: 396 (21.7%)
2025-11-25 09:10:56,981 - INFO -    Noise: 0 (0.0%)
2025-11-25 09:10:56,981 - INFO -    Overlap: 360 (58.2%)
2025-11-25 09:10:56,982 - INFO - üìä Priority stats (validation):
2025-11-25 09:10:56,982 - INFO -    Raw: [0.39, 77.57]
2025-11-25 09:10:56,982 - INFO -    Mean: 5.23 ¬± 12.55
2025-11-25 09:10:56,982 - INFO - ‚úÖ Loaded 619 validation scenarios
2025-11-25 09:10:56,982 - INFO -
================================================================================
2Ô∏è‚É£  DENSE OVERLAPS (n=6‚Äì8)
================================================================================
2025-11-25 09:10:57,132 - INFO - n=6: œÅ=1.000
2025-11-25 09:10:57,154 - INFO - n=7: œÅ=1.000
2025-11-25 09:10:57,182 - INFO - n=8: œÅ=1.000
2025-11-25 09:10:57,182 - INFO -
================================================================================
3Ô∏è‚É£  MONOTONICITY & SENSITIVITY
================================================================================
2025-11-25 09:10:57,188 - INFO - SNR +2 ‚Üí Œîpred=0.1333
2025-11-25 09:10:57,192 - INFO - Distance +33% ‚Üí Œîpred=-0.0402
2025-11-25 09:10:57,192 - INFO -
================================================================================
4Ô∏è‚É£  CALIBRATION & SPREAD
================================================================================
2025-11-25 09:10:58,502 - INFO - mean(pred)=0.549 mean(true)=0.486
2025-11-25 09:10:58,502 - INFO - std(pred)=0.163 std(true)=0.120
2025-11-25 09:10:58,502 - INFO - max(pred)=0.861 max(true)=0.728
2025-11-25 09:10:58,502 - INFO - Max gap=-0.133
2025-11-25 09:10:58,502 - INFO -
================================================================================
5Ô∏è‚É£  UNCERTAINTY QUALITY
================================================================================
2025-11-25 09:11:00,066 - INFO -    [n=6] meta:6.85e-01 overlap:4.80e-01 temp:0.00e+00 edge:0.00e+00 snr:5.03e-01
2025-11-25 09:11:00,126 - INFO - corr(|error|, unc)=0.713
2025-11-25 09:11:00,126 - INFO -
================================================================================
5Ô∏è‚É£DistSep DISTRIBUTION SEPARATION & SHARPNESS
================================================================================
2025-11-25 09:11:02,478 - INFO - üéØ AUC (High vs Low SNR separation): 0.9883
2025-11-25 09:11:02,479 - INFO - üìä Entropy (Lower = Sharper):
2025-11-25 09:11:02,479 - INFO -    High SNR: 184.2158
2025-11-25 09:11:02,479 - INFO -    Low SNR:  5.1134
2025-11-25 09:11:02,479 - INFO -    All:      258.8091
2025-11-25 09:11:02,479 - INFO - ‚ö° Sharpness (Higher = More Decisive):
2025-11-25 09:11:02,479 - INFO -    High SNR: 0.9972
2025-11-25 09:11:02,479 - INFO -    Low SNR:  0.9987
2025-11-25 09:11:02,479 - INFO -    All:      0.9940
2025-11-25 09:11:02,481 - INFO - üìè Wasserstein Distance (High vs Low): 0.4139
2025-11-25 09:11:02,482 - INFO - üîÄ KL Divergence (High vs Low): 18.5747
2025-11-25 09:11:02,482 - INFO -
üìà Statistical Summary:
2025-11-25 09:11:02,483 - INFO -    High SNR mean=0.631 std=0.110
2025-11-25 09:11:02,483 - INFO -    Low SNR  mean=0.217 std=0.082
2025-11-25 09:11:02,483 - INFO -    All      mean=0.559 std=0.167
2025-11-25 09:11:02,483 - INFO -    Range: [0.166, 0.861]
2025-11-25 09:11:02,483 - INFO -
================================================================================
6Ô∏è‚É£  EDGE CONDITIONING
================================================================================
2025-11-25 09:11:02,492 - INFO - edge_type_id variance=10.130
2025-11-25 09:11:02,493 - INFO - Unique edge_type_ids: [0 3 6 7] (count: 4)
2025-11-25 09:11:02,493 - INFO - Distribution: {np.int64(0): np.int64(43), np.int64(3): np.int64(14), np.int64(6): np.int64(7), np.int64(7): np.int64(36)}
2025-11-25 09:11:02,493 - INFO -
================================================================================
7Ô∏è‚É£  SNR & N-WISE BREAKDOWN
================================================================================
2025-11-25 09:11:07,637 - INFO - SNR     <8: n=  13 œÅ=0.627
2025-11-25 09:11:07,638 - INFO - SNR   8-12: n=  62 œÅ=0.824
2025-11-25 09:11:07,640 - INFO - SNR  12-20: n= 376 œÅ=0.769
2025-11-25 09:11:07,641 - INFO - SNR    >20: n=1002 œÅ=0.471
2025-11-25 09:11:07,641 - INFO -
================================================================================
üìä COMPREHENSIVE EVALUATION
================================================================================
2025-11-25 09:11:07,655 - INFO - üîç Evaluating PriorityNet on validation set...
Evaluating validation: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 619/619 [00:22<00:00, 27.06it/s]
2025-11-25 09:11:30,536 - INFO - VALIDATION evaluation: 360/360 multi-detection scenarios
2025-11-25 09:11:30,537 - INFO -    Total scenarios: 619 | Success: 1.000 | Failure: 0.000
2025-11-25 09:11:30,537 - INFO -    Corr (selected): 0.728 ¬± 0.395
2025-11-25 09:11:30,537 - INFO -    Spearman(avg, m‚â•3): 0.714 | Kendall(avg, m<3): 0.791
2025-11-25 09:11:30,537 - INFO -    Pairwise Accuracy: 0.831 ¬± 0.202
2025-11-25 09:11:30,537 - INFO -    Precision@3: 0.889 | Time: 22.87s
2025-11-25 09:11:30,537 - INFO - ‚úÖ Evaluation complete:
2025-11-25 09:11:30,537 - INFO -    Samples: 360/360
2025-11-25 09:11:30,537 - INFO -    Success rate: 1.000
2025-11-25 09:11:30,538 - INFO -    Avg correlation: 0.728 ¬± 0.395
2025-11-25 09:11:30,538 - INFO -    Top-K precision: 0.889
2025-11-25 09:11:30,538 - INFO -    Eval time: 22.87s
2025-11-25 09:11:30,538 - INFO -
================================================================================
üîü OOD EXTREMES
================================================================================
2025-11-25 09:11:30,542 - INFO - ‚úÖ High-mass BBH: pred=0.6562
2025-11-25 09:11:30,545 - INFO - ‚úÖ Extreme spins: pred=0.5274
2025-11-25 09:11:30,547 - INFO - ‚úÖ Close BNS: pred=0.6831
2025-11-25 09:11:30,548 - INFO - ‚úÖ Far BBH: pred=0.4026
2025-11-25 09:11:30,548 - INFO -
================================================================================
1Ô∏è‚É£1Ô∏è‚É£ REAL EVENTS (GWTC-3) + DECOY TESTS
================================================================================
2025-11-25 09:11:30,548 - INFO - üì° Fetching GWTC-3 catalog from GWOSC API...
2025-11-25 09:11:47,796 - INFO - üì¶ API returned 35 raw events
2025-11-25 09:11:47,796 - INFO - ‚úÖ Loaded 35 events with valid parameters from GWTC-3 API
2025-11-25 09:11:47,870 - INFO - GW200129_065458-v1: pred=0.6604 unc=0.0105 snr=26.8 m1=34.5 m2=29.0
2025-11-25 09:11:47,872 - INFO - GW200224_222234-v1: pred=0.5657 unc=0.0021 snr=20.0 m1=40.0 m2=32.7
2025-11-25 09:11:47,874 - INFO - GW200112_155838-v1: pred=0.5560 unc=0.0021 snr=19.8 m1=35.6 m2=28.3
2025-11-25 09:11:47,876 - INFO - GW191216_213338-v1: pred=0.5299 unc=0.0027 snr=18.6 m1=12.1 m2=7.7
2025-11-25 09:11:47,877 - INFO - GW200311_115853-v1: pred=0.5276 unc=0.0022 snr=17.8 m1=34.2 m2=27.7
2025-11-25 09:11:47,878 - INFO - GW191204_171526-v1: pred=0.5072 unc=0.0027 snr=17.4 m1=11.7 m2=8.4
2025-11-25 09:11:47,879 - INFO - GW191109_010717-v1: pred=0.5523 unc=0.0019 snr=17.3 m1=65.0 m2=47.0
2025-11-25 09:11:47,882 - INFO - GW191129_134029-v1: pred=0.4518 unc=0.0033 snr=13.1 m1=10.7 m2=6.7
2025-11-25 09:11:47,885 - INFO - GW200225_060421-v1: pred=0.4492 unc=0.0031 snr=12.5 m1=19.3 m2=14.0
2025-11-25 09:11:47,889 - INFO - GW191222_033537-v1: pred=0.4524 unc=0.0025 snr=12.5 m1=45.1 m2=34.7
2025-11-25 09:11:47,890 - INFO - GW200115_042309-v2: pred=0.4435 unc=0.0039 snr=11.3 m1=5.9 m2=1.4
2025-11-25 09:11:47,891 - INFO - GW191215_223052-v1: pred=0.4341 unc=0.0032 snr=11.2 m1=24.9 m2=18.1
2025-11-25 09:11:47,891 - INFO - GW200302_015811-v1: pred=0.4223 unc=0.0030 snr=10.8 m1=37.8 m2=20.0
2025-11-25 09:11:47,892 - INFO - GW200208_130117-v1: pred=0.4278 unc=0.0029 snr=10.8 m1=37.7 m2=27.4
2025-11-25 09:11:47,894 - INFO - GW200202_154313-v1: pred=0.4335 unc=0.0038 snr=10.8 m1=10.1 m2=7.3
2025-11-25 09:11:47,896 - INFO - GW200219_094415-v1: pred=0.4269 unc=0.0030 snr=10.7 m1=37.5 m2=27.9
2025-11-25 09:11:47,898 - INFO - GW200128_022011-v1: pred=0.4251 unc=0.0029 snr=10.6 m1=42.2 m2=32.6
2025-11-25 09:11:47,899 - INFO - GW191230_180458-v1: pred=0.4200 unc=0.0027 snr=10.4 m1=49.4 m2=37.0
2025-11-25 09:11:47,901 - INFO - GW200316_215756-v1: pred=0.4205 unc=0.0036 snr=10.3 m1=13.1 m2=7.8
2025-11-25 09:11:47,902 - INFO - GW191105_143521-v1: pred=0.4176 unc=0.0038 snr=9.7 m1=10.7 m2=7.7
2025-11-25 09:11:47,903 - INFO - GW200209_085452-v1: pred=0.4140 unc=0.0032 snr=9.6 m1=35.6 m2=27.1
2025-11-25 09:11:47,906 - INFO - GW191127_050227-v1: pred=0.3949 unc=0.0030 snr=9.2 m1=53.0 m2=24.0
2025-11-25 09:11:47,909 - INFO - GW191219_163120-v1: pred=0.3793 unc=0.0038 snr=9.1 m1=31.1 m2=1.2
2025-11-25 09:11:47,912 - INFO - GW191204_110529-v1: pred=0.4073 unc=0.0035 snr=8.9 m1=27.3 m2=19.2
2025-11-25 09:11:47,915 - INFO - GW191103_012549-v1: pred=0.4085 unc=0.0039 snr=8.9 m1=11.8 m2=7.9
2025-11-25 09:11:47,916 - INFO - GW200220_124850-v1: pred=0.3994 unc=0.0033 snr=8.5 m1=38.9 m2=27.9
2025-11-25 09:11:47,917 - INFO - GW200210_092254-v1: pred=0.3775 unc=0.0039 snr=8.4 m1=24.1 m2=2.8
2025-11-25 09:11:47,918 - INFO - GW191126_115259-v1: pred=0.4032 unc=0.0040 snr=8.3 m1=12.1 m2=8.3
2025-11-25 09:11:47,919 - INFO - GW200216_220804-v1: pred=0.3865 unc=0.0031 snr=8.1 m1=51.0 m2=30.0
2025-11-25 09:11:47,921 - INFO - GW191113_071753-v1: pred=0.3712 unc=0.0039 snr=7.9 m1=29.0 m2=5.9
2025-11-25 09:11:47,921 - INFO -
üìä Real events summary (n=30):
2025-11-25 09:11:47,921 - INFO -   pred: mean=0.449 std=0.067 range=[0.371, 0.660]
2025-11-25 09:11:47,921 - INFO -   unc:  mean=0.003 std=0.001
2025-11-25 09:11:47,921 - INFO -   SNR:  range=[7.9, 26.8]
2025-11-25 09:11:47,921 - INFO - ‚úÖ Prediction diversity: std=0.067
2025-11-25 09:11:47,921 - INFO -
üé≠ Decoy tests:
2025-11-25 09:11:47,924 - INFO - ‚úÖ GW191109: real=0.406 decoy=0.249
2025-11-25 09:11:47,926 - INFO - ‚úÖ GW191216: real=0.384 decoy=0.276
2025-11-25 09:11:47,932 - INFO - ‚úÖ GW200311: real=0.370 decoy=0.264
2025-11-25 09:11:47,933 - INFO -
================================================================================
üèÅ FINAL VERDICT
================================================================================
2025-11-25 09:11:47,933 - INFO - ‚úÖ ALL GATES PASSED ‚Äî MODEL IS PRODUCTION-READY üöÄ